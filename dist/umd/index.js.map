{
  "version": 3,
  "sources": ["../../src/index.ts", "../../src/constants.ts"],
  "sourcesContent": ["import {\n  IFRAME_ID,\n  POPUP_WIDTH,\n  POPUP_HEIGHT,\n  CONNECT_POPUP_HEIGHT,\n  CONNECT_POPUP_WIDTH,\n  ACK_EVENT,\n  CANCEL_EVENT,\n  URL_EVENT,\n  DONE_EVENT,\n  ERROR_EVENT,\n  PING_EVENT,\n  WINDOW_EVENT,\n  ROUTE_EVENT,\n  USER_EVENT,\n  STYLES_ID,\n  CONNECT_SDK_VERSION,\n  CLOSE_POPUP_EVENT,\n  PLATFORM_POPUP,\n  PLATFORM_IFRAME,\n} from './constants';\n\nlet evHandlers: ConnectEventHandlers;\nlet onMessageFn: any;\nlet connectUrl: string;\nlet iframe: any;\nlet metaEl: any;\nlet targetWindow: Window;\nlet connectOrigin: string;\nlet popupWindow: Window | null;\n\nexport interface ConnectEventHandlers {\n  onDone: (event: ConnectDoneEvent) => void;\n  onCancel: (event: ConnectCancelEvent) => void;\n  onError: (event: ConnectErrorEvent) => void;\n  onRoute?: (event: ConnectRouteEvent) => void;\n  onUser?: (event: any) => void;\n  onLoad?: () => void;\n}\n\nconst defaultEventHandlers: any = {\n  onLoad: () => {},\n  onUser: (event: any) => {},\n  onRoute: (event: ConnectRouteEvent) => {},\n};\n\nexport interface ConnectProps {\n  connectUrl: string;\n  eventHandlers: ConnectEventHandlers;\n  linkingUri?: string;\n}\n\nexport interface ConnectCancelEvent {\n  code: number;\n  reason: string;\n}\n\nexport interface ConnectErrorEvent {\n  code: number;\n  reason: string;\n}\n\nexport interface ConnectDoneEvent {\n  code: number;\n  reason: string;\n  reportData: [\n    {\n      portfolioId: string;\n      type: string;\n      reportId: string;\n    }\n  ];\n}\n\nexport interface ConnectRouteEvent {\n  screen: string;\n  params: any;\n}\n\nexport interface ConnectOptions {\n  selector?: string;\n  node?: Node;\n  overlay?: string;\n  popup?: boolean;\n  popupOptions?: PopupOptions;\n  redirectUrl?: string;\n}\n\nexport interface PopupOptions {\n  width?: number;\n  height?: number;\n  top?: number;\n  left?: number;\n}\n\ninterface Connect {\n  destroy: () => void;\n  launch: (\n    url: string,\n    eventHandlers: ConnectEventHandlers,\n    options?: ConnectOptions\n  ) => Window | null | void;\n  initPostMessage: (options: ConnectOptions) => void;\n  openPopupWindow: (url: string) => void;\n  postMessage: (event: any) => void;\n}\n\nexport const Connect: Connect = {\n  destroy() {\n    if (iframe && iframe.parentNode) {\n      iframe.parentNode.removeChild(iframe);\n    }\n\n    if (metaEl && metaEl.parentNode) {\n      metaEl.parentNode.removeChild(metaEl);\n    }\n\n    if (!iframe && targetWindow) {\n      targetWindow.close();\n    }\n\n    iframe = undefined;\n    metaEl = undefined;\n\n    window.removeEventListener('message', onMessageFn);\n  },\n\n  launch(\n    url: string,\n    eventHandlers: ConnectEventHandlers,\n    options: ConnectOptions = {}\n  ) {\n    connectUrl = url;\n    evHandlers = { ...defaultEventHandlers, ...eventHandlers };\n    connectOrigin = new URL(connectUrl).origin;\n\n    if (options.popup) {\n      const defaultPopupOptions = {\n        toolbar: 'no',\n        location: 'no',\n        status: 'no',\n        menubar: 'no',\n        width: CONNECT_POPUP_HEIGHT,\n        height: CONNECT_POPUP_WIDTH,\n        top:\n          window.self.outerHeight / 2 +\n          window.self.screenY -\n          CONNECT_POPUP_HEIGHT / 2,\n        left:\n          window.self.outerWidth / 2 +\n          window.self.screenX -\n          CONNECT_POPUP_WIDTH / 2,\n      };\n      const popupOptions = { ...defaultPopupOptions, ...options.popupOptions };\n      const popupWindow = window.open(\n        connectUrl,\n        'targetWindow',\n        `toolbar=${defaultPopupOptions.toolbar},location=${defaultPopupOptions.location},status=${defaultPopupOptions.status},menubar=${defaultPopupOptions.menubar},width=${popupOptions.width},height=${popupOptions.height},top=${popupOptions.top},left=${popupOptions.left}`\n      );\n\n      if (!popupWindow) {\n        evHandlers.onError({ reason: 'error', code: 1403 });\n      } else {\n        targetWindow = popupWindow;\n        popupWindow.focus();\n        this.initPostMessage(options);\n        evHandlers.onLoad && evHandlers.onLoad();\n      }\n\n      return popupWindow;\n    } else {\n      if (iframe && iframe.parentNode) {\n        throw new Error(\n          'You must destroy the iframe before you can open a new one. Call \"destroy()\"'\n        );\n      }\n\n      if (!document.getElementById(STYLES_ID)) {\n        const style = document.createElement('style');\n        style.id = STYLES_ID;\n        style.type = 'text/css';\n        style.innerHTML = `#${IFRAME_ID} {\n          position: absolute;\n          left: 0;\n          top: 0;\n          width: 100%;\n          height: 100%;\n          z-index: 10;\n          background: rgba(0,0,0,0.8);\n        }`;\n        document.getElementsByTagName('head')[0].appendChild(style);\n      }\n\n      let metaArray = document.querySelectorAll('meta[name=\"viewport\"]');\n      if (metaArray.length === 0) {\n        metaEl = document.createElement('meta');\n        metaEl.setAttribute('name', 'viewport');\n        metaEl.setAttribute('content', 'initial-scale=1');\n        document.head.appendChild(metaEl);\n      }\n\n      iframe = document.createElement('iframe');\n\n      iframe.src = connectUrl;\n      iframe.setAttribute('id', IFRAME_ID);\n      iframe.setAttribute('frameborder', '0');\n      iframe.setAttribute('scrolling', 'no');\n      iframe.setAttribute('aria-label', 'Launching Modal');\n      iframe.setAttribute('title', 'Launching Modal');\n\n      // NOTE: update overlay\n      if (options.overlay) {\n        iframe.setAttribute('style', `background: ${options.overlay};`);\n      }\n\n      if (options.node) {\n        options.node.appendChild(iframe);\n      } else {\n        // NOTE: attach to selector if specified\n        const parentEl = !!options.selector\n          ? document.querySelector(options.selector)\n          : document.body;\n        if (parentEl) {\n          parentEl.appendChild(iframe);\n        } else {\n          console.warn(\n            `Couldn't find any elements matching \"${options.selector}\", appending \"iframe\" to \"body\" instead.`\n          );\n          document.body.appendChild(iframe);\n        }\n      }\n\n      iframe.onload = () => {\n        targetWindow = iframe.contentWindow;\n        this.initPostMessage(options);\n        evHandlers.onLoad && evHandlers.onLoad();\n      };\n\n      return null;\n    }\n  },\n\n  initPostMessage(options: ConnectOptions) {\n    // NOTE: ping connect until it responds\n    const intervalId = setInterval(() => {\n      const data = {\n        type: PING_EVENT,\n        selector: options.selector,\n        sdkVersion: CONNECT_SDK_VERSION,\n        platform: `${options.popup ? PLATFORM_POPUP : PLATFORM_IFRAME}`,\n      };\n      if (options.redirectUrl) data['redirectUrl'] = options.redirectUrl;\n\n      this.postMessage(data);\n    }, 1000);\n\n    onMessageFn = (event: any) => {\n      const payload = event.data.data;\n      const eventType = event.data.type;\n      // NOTE: make sure it's Connect and not a bad actor\n      if (event.origin === connectOrigin) {\n        // NOTE: actively pinging connect while it's displayed in a popup allows us to recover the\n        // session if the user refreshes the popup window\n        if (eventType === ACK_EVENT && !options.popup) {\n          clearInterval(intervalId);\n        } else if (eventType === URL_EVENT) {\n          this.openPopupWindow(event.data.url);\n        } else if (eventType === DONE_EVENT) {\n          evHandlers.onDone(payload);\n          this.destroy();\n        } else if (eventType === CANCEL_EVENT) {\n          evHandlers.onCancel(payload);\n          this.destroy();\n        } else if (eventType === ERROR_EVENT) {\n          evHandlers.onError(payload);\n          this.destroy();\n        } else if (eventType === ROUTE_EVENT) {\n          evHandlers.onRoute && evHandlers.onRoute(payload);\n        } else if (eventType === USER_EVENT) {\n          evHandlers.onUser && evHandlers.onUser(payload);\n        } else if (eventType === CLOSE_POPUP_EVENT) {\n          popupWindow?.close();\n        }\n      }\n    };\n\n    window.addEventListener('message', onMessageFn);\n  },\n\n  openPopupWindow(url: string) {\n    const top =\n      window.self.outerHeight / 2 + window.self.screenY - POPUP_HEIGHT / 2;\n    const left =\n      window.self.outerWidth / 2 + window.self.screenX - POPUP_WIDTH / 2;\n    popupWindow = window.open(\n      url,\n      'targetWindow',\n      `toolbar=no,location=no,status=no,menubar=no,width=${POPUP_WIDTH},height=${POPUP_HEIGHT},top=${top},left=${left}`\n    );\n\n    if (popupWindow) {\n      popupWindow.focus();\n      const intervalId = setInterval(() => {\n        // clear itself if window no longer exists or has been closed\n        if (popupWindow?.closed) {\n          // window closed, notify connect\n          clearInterval(intervalId);\n          this.postMessage({\n            type: WINDOW_EVENT,\n            closed: true,\n            blocked: false,\n          });\n        }\n      }, 1000);\n    } else {\n      this.postMessage({\n        type: WINDOW_EVENT,\n        closed: true,\n        blocked: true,\n      });\n    }\n  },\n\n  postMessage(data: any) {\n    targetWindow?.postMessage(data, connectUrl);\n  },\n};\n\nexport default Connect;\n", "// NOTE: Changing this value should be considered a version breaking change!!!\nexport const IFRAME_ID = 'connectIframe';\nexport const STYLES_ID = 'connectStyles';\nexport const PLATFORM_IFRAME = 'iframe';\nexport const PLATFORM_POPUP = 'web';\nexport const CONNECT_SDK_VERSION = 'PACKAGE_VERSION';\n\n// NOTE: oauth popup window dimensions\nexport const POPUP_WIDTH = 600;\nexport const POPUP_HEIGHT = 600;\n\n// NOTE: connect popup window dimensions\nexport const CONNECT_POPUP_WIDTH = 520;\nexport const CONNECT_POPUP_HEIGHT = 720;\n\n// NOTE: available events\nexport const ACK_EVENT = 'ack';\nexport const CANCEL_EVENT = 'cancel';\nexport const URL_EVENT = 'url';\nexport const DONE_EVENT = 'done';\nexport const ERROR_EVENT = 'error';\nexport const PING_EVENT = 'ping';\nexport const WINDOW_EVENT = 'window';\nexport const ROUTE_EVENT = 'route';\nexport const USER_EVENT = 'user';\nexport const CLOSE_POPUP_EVENT = 'closePopup';\n"],
  "mappings": "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",
  "names": ["popupWindow"]
}
